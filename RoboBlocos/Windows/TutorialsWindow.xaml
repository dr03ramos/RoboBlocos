<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="RoboBlocos.TutorialsWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Title="Tutoriais do RoboBlocos">

    <Window.SystemBackdrop>
        <MicaBackdrop />
    </Window.SystemBackdrop>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- TitleBar -->
        <TitleBar x:Name="TutorialsTitleBar"
                  Grid.Row="0"
                  Title="Tutoriais do RoboBlocos"
                  IsBackButtonVisible="True"
                  BackRequested="TitleBar_BackRequested"/>

        <!-- Layout em 2 colunas: Lista à esquerda, Conteúdo à direita -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="320"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Painel esquerdo: Lista de tutoriais -->
            <Grid Grid.Column="0" Background="{ThemeResource LayerFillColorDefaultBrush}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Cabeçalho com SearchBox -->
                <StackPanel Grid.Row="0" Padding="16" Spacing="12">
                    <!-- SearchBox para filtrar tutoriais -->
                    <AutoSuggestBox x:Name="SearchBox"
                                    PlaceholderText="Buscar tutoriais..."
                                    QueryIcon="Find"
                                    TextChanged="SearchBox_TextChanged"/>
                </StackPanel>

                <!-- Lista de tutoriais -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <ItemsRepeater x:Name="TutorialsList" Margin="8,0,8,16">
                        <ItemsRepeater.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="8,4" 
                                      Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                                      BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                      BorderThickness="1"
                                      CornerRadius="8"
                                      Padding="12">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <!-- Título -->
                                    <TextBlock Grid.Row="0"
                                               Text="{Binding Title}"
                                               Style="{StaticResource BodyStrongTextBlockStyle}"
                                               TextWrapping="Wrap"
                                               Margin="0,0,0,4"/>

                                    <!-- Descrição -->
                                    <TextBlock Grid.Row="1"
                                               Text="{Binding Description}"
                                               Style="{StaticResource CaptionTextBlockStyle}"
                                               TextWrapping="Wrap"
                                               Opacity="0.7"
                                               Margin="0,0,0,8"
                                               MaxLines="2"/>

                                    <!-- Número de passos -->
                                    <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="4" Margin="0,0,0,8">
                                        <FontIcon Glyph="&#xE8FD;" FontSize="12" Opacity="0.7"/>
                                        <TextBlock Text="{Binding StepsCount}"
                                                   Style="{StaticResource CaptionTextBlockStyle}"
                                                   Opacity="0.7"/>
                                        <TextBlock Text="passos"
                                                   Style="{StaticResource CaptionTextBlockStyle}"
                                                   Opacity="0.7"/>
                                    </StackPanel>

                                    <!-- Botões de ação -->
                                    <StackPanel Grid.Row="3" Orientation="Horizontal" Spacing="4">
                                        <Button Content="Ver" 
                                                Click="ViewTutorialButton_Click"
                                                Tag="{Binding}"
                                                Style="{StaticResource AccentButtonStyle}"/>
                                        <Button Content="Editar" 
                                                Click="EditTutorialButton_Click"
                                                Tag="{Binding}"
                                                Visibility="{Binding ShowEditButtons}"/>
                                        <Button Content="Excluir" 
                                                Click="DeleteTutorialButton_Click"
                                                Tag="{Binding}"
                                                Visibility="{Binding ShowEditButtons}"/>
                                    </StackPanel>
                                </Grid>
                            </DataTemplate>
                        </ItemsRepeater.ItemTemplate>
                    </ItemsRepeater>
                </ScrollViewer>

                <!-- Área inferior com botões de ação -->
                <StackPanel Grid.Row="2" Padding="16" Spacing="8">
                    <!-- Separador visual -->
                    <Border Height="1" 
                            Background="{ThemeResource CardStrokeColorDefaultBrush}"
                            Opacity="0.3"
                            Margin="0,0,0,8"/>
                    
                    <!-- Botão Novo Tutorial (visível apenas em modo de edição) -->
                    <Button x:Name="NewTutorialButton" 
                            Click="NewTutorialButton_Click"
                            Visibility="Collapsed"
                            HorizontalAlignment="Stretch">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE710;" FontSize="16"/>
                            <TextBlock Text="Novo Tutorial"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- Botão Modo de Edição -->
                    <Button x:Name="EditModeButton" 
                            Click="EditModeButton_Click"
                            HorizontalAlignment="Stretch">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE72E;" FontSize="16"/>
                            <TextBlock Text="Modo de Edição"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>

            <!-- Painel direito: Conteúdo do tutorial -->
            <Grid Grid.Column="1">
                <!-- Estado vazio (nenhum tutorial selecionado) -->
                <StackPanel x:Name="EmptyStatePanel"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Spacing="16"
                            Visibility="Visible">
                    <FontIcon Glyph="&#xE82D;" FontSize="64" Opacity="0.3"/>
                    <TextBlock Text="Selecione um tutorial para visualizar"
                               Style="{StaticResource SubtitleTextBlockStyle}"
                               Opacity="0.6"/>
                </StackPanel>

                <!-- Visualizador de tutorial -->
                <ScrollViewer x:Name="ViewerScrollViewer"
                              Visibility="Collapsed"
                              VerticalScrollBarVisibility="Auto"
                              Padding="32">
                    <StackPanel Spacing="24">
                        <!-- Cabeçalho do tutorial -->
                        <StackPanel Spacing="8">
                            <TextBlock x:Name="ViewerTitle"
                                       Style="{StaticResource TitleLargeTextBlockStyle}"
                                       TextWrapping="Wrap"/>
                            <TextBlock x:Name="ViewerDescription"
                                       Style="{StaticResource BodyTextBlockStyle}"
                                       Opacity="0.8"
                                       TextWrapping="Wrap"/>
                            
                            <StackPanel Orientation="Horizontal" Spacing="4" Margin="0,8,0,0">
                                <FontIcon Glyph="&#xE8FD;" FontSize="16" Opacity="0.7"/>
                                <TextBlock x:Name="ViewerStepsCount"
                                           Style="{StaticResource CaptionTextBlockStyle}"
                                           Opacity="0.7"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Container para todos os passos -->
                        <StackPanel x:Name="AllStepsContainer" Spacing="32"/>
                    </StackPanel>
                </ScrollViewer>

                <!-- Editor de tutorial -->
                <ScrollViewer x:Name="EditorScrollViewer"
                              Visibility="Collapsed"
                              VerticalScrollBarVisibility="Auto"
                              Padding="32">
                    <StackPanel Spacing="24">
                        <!-- Cabeçalho do editor -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="Editor de Tutorial"
                                       Style="{StaticResource TitleLargeTextBlockStyle}"/>
                            
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <Button x:Name="SaveTutorialButton"
                                        Click="SaveTutorialButton_Click"
                                        Style="{StaticResource AccentButtonStyle}">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <FontIcon Glyph="&#xE74E;" FontSize="16"/>
                                        <TextBlock Text="Salvar"/>
                                    </StackPanel>
                                </Button>
                                <Button x:Name="CancelEditButton"
                                        Click="CancelEditButton_Click">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <FontIcon Glyph="&#xE711;" FontSize="16"/>
                                        <TextBlock Text="Cancelar"/>
                                    </StackPanel>
                                </Button>
                            </StackPanel>
                        </StackPanel>

                        <!-- Campos de metadados -->
                        <TextBox x:Name="EditTitle"
                                 Header="Título"
                                 PlaceholderText="Digite o título do tutorial"/>
                        
                        <TextBox x:Name="EditDescription"
                                 Header="Descrição"
                                 PlaceholderText="Digite uma breve descrição"
                                 TextWrapping="Wrap"
                                 AcceptsReturn="True"
                                 MinHeight="80"/>

                        <!-- Gerenciador de passos -->
                        <StackPanel Spacing="12">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <TextBlock Text="Passos do Tutorial"
                                           Style="{StaticResource SubtitleTextBlockStyle}"
                                           VerticalAlignment="Center"/>
                                <Button x:Name="AddStepButton"
                                        Click="AddStepButton_Click"
                                        ToolTipService.ToolTip="Adicionar passo">
                                    <FontIcon Glyph="&#xE710;" FontSize="16"/>
                                </Button>
                            </StackPanel>

                            <ItemsRepeater x:Name="StepsList">
                                <ItemsRepeater.ItemTemplate>
                                    <DataTemplate>
                                        <Expander HorizontalAlignment="Stretch"
                                                  Margin="0,0,0,8"
                                                  IsExpanded="True">
                                            <Expander.Header>
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>

                                                    <TextBlock Grid.Column="0"
                                                               Text="{Binding StepNumber}"
                                                               Style="{StaticResource BodyStrongTextBlockStyle}"
                                                               Margin="0,0,12,0"/>
                                                    
                                                    <TextBlock Grid.Column="1"
                                                               Text="{Binding Title}"
                                                               Style="{StaticResource BodyTextBlockStyle}"
                                                               TextTrimming="CharacterEllipsis"/>
                                                    
                                                    <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="4">
                                                        <Button Click="MoveStepUpButton_Click"
                                                                Tag="{Binding}"
                                                                ToolTipService.ToolTip="Mover para cima"
                                                                Padding="4">
                                                            <FontIcon Glyph="&#xE74A;" FontSize="12"/>
                                                        </Button>
                                                        <Button Click="MoveStepDownButton_Click"
                                                                Tag="{Binding}"
                                                                ToolTipService.ToolTip="Mover para baixo"
                                                                Padding="4">
                                                            <FontIcon Glyph="&#xE74B;" FontSize="12"/>
                                                        </Button>
                                                        <Button Click="DeleteStepButton_Click"
                                                                Tag="{Binding}"
                                                                ToolTipService.ToolTip="Excluir passo"
                                                                Padding="4">
                                                            <FontIcon Glyph="&#xE74D;" FontSize="12"/>
                                                        </Button>
                                                    </StackPanel>
                                                </Grid>
                                            </Expander.Header>

                                            <StackPanel Padding="16" Spacing="12">
                                                <TextBox Text="{Binding Title, Mode=TwoWay}"
                                                         Header="Título do Passo"
                                                         PlaceholderText="Digite o título"/>
                                                
                                                <TextBox Text="{Binding Content, Mode=TwoWay}"
                                                         Header="Conteúdo"
                                                         PlaceholderText="Digite o conteúdo do passo"
                                                         TextWrapping="Wrap"
                                                         AcceptsReturn="True"
                                                         MinHeight="120"/>
                                                
                                                <StackPanel Spacing="8">
                                                    <TextBlock Text="Imagem (opcional)"
                                                               Style="{StaticResource CaptionTextBlockStyle}"/>
                                                    <Button Click="SelectImageButton_Click"
                                                            Tag="{Binding}">
                                                        <StackPanel Orientation="Horizontal" Spacing="8">
                                                            <FontIcon Glyph="&#xE8B9;" FontSize="16"/>
                                                            <TextBlock Text="Selecionar Imagem"/>
                                                        </StackPanel>
                                                    </Button>
                                                    <TextBlock Text="{Binding ImagePath}"
                                                               Style="{StaticResource CaptionTextBlockStyle}"
                                                               Opacity="0.6"
                                                               TextTrimming="CharacterEllipsis"/>
                                                </StackPanel>
                                                
                                                <TextBox Text="{Binding CodeSnippet, Mode=TwoWay}"
                                                         Header="Snippet de Código (opcional)"
                                                         PlaceholderText="Cole ou digite código de exemplo"
                                                         FontFamily="Consolas"
                                                         TextWrapping="Wrap"
                                                         AcceptsReturn="True"
                                                         MinHeight="80"/>
                                            </StackPanel>
                                        </Expander>
                                    </DataTemplate>
                                </ItemsRepeater.ItemTemplate>
                            </ItemsRepeater>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </Grid>
    </Grid>
</Window>
